---
title: "All about cracks and shapes"
subtitle: "in a nutshell"
author: "**Erik Am√©zquita**, Michelle Quigley, Pat Brown<br>Liz Munch, Dan Chitwood <br> &mdash; <br> Plant Sciences & Mathematics <br> University of Missouri <br> &mdash;"
date: "2023-10-12 <br> - <br> Preprint available: [10.1101/2023.09.26.559651](https://doi.org/10.1101/2023.09.26.559651)"
output:
  xaringan::moon_reader:
    css: ["../../css/mu.css", default-fonts, "../../css/gallery.css"]
    chakra: '../../js/remark-latest.min.js'
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
library(reticulate)
library(knitr)

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(fig.align = 'center')
```

background-image: url("../../img/endlessforms.png")
background-size: 150px
background-position: 89% 7%

class: inverse

# Plant morphology

<div class="row">
  <div class="column" style="max-width:50%">
    <iframe width="375" height="210" src="https://www.youtube-nocookie.com/embed/Cr0B-yFcJZk?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    <iframe width="375" height="210" src="https://www.youtube-nocookie.com/embed/ikhuvGpJbeA?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>
  <div class="column" style="max-width:50%">
    <iframe width="375" height="210" src="https://www.youtube-nocookie.com/embed/lZXSpPzstF8?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    <iframe width="375" height="210" src="https://www.youtube-nocookie.com/embed/qkOjHHuoUhA?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
  </div>
</div>
<p style="font-size: 24px; text-align: right; font-family: 'Yanone Kaffeesatz'">Check out more 3D X-ray CT scans at <a href="https://www.youtube.com/@endlessforms6756">youtube.com/@endlessforms6756</a></p>

---

# The wal(nu)tzing nutcracker!

<div class="row" style="font-family: 'Yanone Kaffeesatz'; margin: 0 auto; font-size:22px">
  <div class="column" style="max-width:25%;">
    <img src="../figs/IMGA04011.jpg">
    <p style="text-align: center;">148 accessions</p>
  </div>
  <div class="column" style="max-width:42%;">
    <img src="../../barley/figs/x3000_setup.jpg">
    <p style="text-align: center;">1301 walnuts scanned</p>
  </div>
  <div class="column" style="max-width:33%;">
    <img src="../figs/pat_walnut_crack_detail4.jpg">
    <p style="text-align: center;">Qualitative data for crackability</p>
  </div>
</div>

<div class="row" style="font-size: 22px; font-family: 'Yanone Kaffeesatz'; margin: 0 auto;">
  <div class="column" style="max-width:20%;">
    <img src="../figs/2014SBa_R5_T81_shell_1.gif">
    <p style="text-align: center; margin: 0.5ex;">Shell</p>
  </div>
  <div class="column" style="max-width:20%;">
    <img src="../figs/2014SBa_R1_T3_001_air.gif">
    <p style="text-align: center;margin: 0.5ex; ">Air</p>
  </div>
  <div class="column" style="max-width:20%;">
    <img src="../figs/2014SBa_R1_T3_001_vein.gif">
    <p style="text-align: center;margin: 0.5ex; ">Packing tissue</p>
  </div>
  <div class="column" style="max-width:20%;">
    <img src="../figs/2014SBa_R5_T81_meat_2.gif">
    <p style="text-align: center;margin: 0.5ex;">Kernel</p>
  </div>
  <div class="column" style="max-width:20%; padding: 0 0 0 5px">
    <p style="margin:5px 0 0 0; text-align:left">
      &#9656;&ensp;Individuals separated manually<br>
      &#9656;&ensp;Tissues separated with watershed segmentation<br>
      &#9656;&ensp;38 traditional shape and size descriptors
    </p>
  </div>
</div>


---

## Watershed segmentation

![](../figs/2014SBa_R5_T20_001_w.gif)

---

## Shape and size phenotypes

.pull-left[
![](../figs/walnut_trad_measurements.png)

]

.pull-right[
![](../figs/kernel_trad_measurements.png)
]

```{r, out.width=600}
knitr::include_graphics("../figs/convexity_curves.jpg")
```

---

# 49 image-based phenotypes!

.pull-left[
**Whole Walnut**

- Length, width, height
- Raw  and *convex* Volume
- Raw and *convex* surface Area
- *Convexity ratios*
- Sphericity indices

**Kernel and its *main cavity***

- Length, width, height
- Raw  and *convex* total volume
- Volume relative to total and *without air*
- Raw and *convex* surface area
- *Convexity ratios*
- *Sphericity indices*
]

.pull-right[
**Shell**

- Absolute and relative total volume
- Absolute and relative *protruding* volume
- Average thickness
- *Average density* relative to kernel
- *Average density* relative to packing tissue

**Air**

- Total and relative volume

***Packing tissue***

- *Absolute and relative total Volume*
- *Relative density to kernel*
]

Italics for phenotypes that I haven't seen measured elsewhere

---

class: center, middle, inverse

# Using **all** the individual nuts' phenotypes

## Each point represents a different individual

---

# The power of allometry: $\;y = e^bV_N^m$

Different tissues grow at different rates with respect to each other.

Growth does **not** scale linearly but it follows a power law.

<div class="row" style="color: black; font-size: 20px; font-family: 'Yanone Kaffeesatz'; margin: 0 auto;">
  <div class="column" style="max-width:33%;">
    <img src="../../walnuts/figs/nut_convex_volume_vs_nut_volume.png">
    <p style="padding: 0 2ex 0 0;">Walnut changes dramatically after its diameter is larger than 1.6cm (&frac58;")</p>
  </div>
  <div class="column" style="max-width:33%;">
    <img src="../../walnuts/figs/air_volume_vs_nut_volume.png">
    <p style="margin: 3px 0 0 0; padding: 0 2ex 0 0;">If nut volume increases by 2x, then air volume increases by 2.3x</p>
    <p style="padding: 0 2ex 0 0;">Walnut diameter cannot go beyond 15cm (6")</p>
  </div>
  <div class="column" style="max-width:33%;">
    <img src="../../walnuts/figs/kernel_volume_vs_nut_volume.png">
    <p style="margin: 1.1ex 0 0 0; padding: 0 2ex 0 0;">If nut volume increases by 2x, then kernel volume only increases by 1.8x</p>
  </div>
</div>

There are biophysical constraints at play in walnut development

---

## Correlation between tissues



---

## Correlation with traits of interest

![](../../walnuts/figs/combination_hbar_correlation.jpg)

.pull-left[
**Walnuts with more kernel filling ratio have:**

- Less air filling ratio
- Smaller volume
- Smoother shells
- Kernel overall shape is more convex 
- But it also has numerous deep but thin grooves.
] 

.pull-right[
**Walnuts with thinner shells have:**

- Less total shell volume and shell ratio
- More air filling ratio
- Smoother shells
]

---

## Remove the air from the consideration

![](../figs/combination_hbar_correlation_wo_air.jpg)


$$\text{Kernel Volume Ratio}=\frac{V_{\text{kernel}}}{V_{\text{shell}} + V_{\text{kernel}} + V_{\text{packing}} + V_{\text{air}}}$$

$$\text{Kernel Volume Ratio wo Air}=\frac{V_{\text{kernel}}}{V_{\text{shell}} + V_{\text{kernel}} + V_{\text{packing}}}$$

---

class: center, middle, inverse

# Incorporating Pat's ordinal data

## Averaging my morphological phenotypes per accession

## Each point represents a different accession

### Work I did after my defense, when I realized I messed up completely data analysis

---

## Comparing relative volume to relative mass

```{r, out.width=550}
knitr::include_graphics("../figs/vol_ratios_correlation_accession.jpg")
```

---

## Side by side invidual vs accession

```{r, out.width=580}
knitr::include_graphics("../figs/vol_absolute_relative_correlation_accession.png")
```

---

## Correlation to other breeding traits

![](../figs/highest_corrs_ease_of_removal_per_accession_1x5.jpg)

![](../figs/highest_corrs_shell_strength_per_accession_1x5.jpg)

- Now the Earliest (Himalayan) accession is a single outlying point and not much can be said about it.

---

## Correlation to other breeding traits

![](../figs/highest_corrs_kernel_weight_ratio_per_accession_1x5.jpg)

![](../figs/highest_corrs_shell_thickness_per_accession_1x5.jpg)

- Now the Earliest (Himalayan) accession is a single outlying point and not much can be said about it.

---

## PCA (and other dim-reduction) fail

![](../figs/pca_all_phenos_accession.jpg)

---

## Doing linear regressions

- Assumes responses are normally distributed
- Assumes traits are independent
- I used ridge-regression, as OLS tend to overfit when conditions are not ideal
- Linear coefficients are not really informative when conditions are not ideal


```{r, out.width=550}
knitr::include_graphics("../figs/kernelfill_ridge_regression.jpg")
```

---

## Training 80/20 to spot overfitting

.pull-left[
![](../figs/kernelfill_R2_train_vs_test.jpg)
![](../figs/percentkernel_R2_train_vs_test.jpg)
]

.pull-right[
![](../figs/shellstrength_R2_train_vs_test.jpg)
![](../figs/easeofremoval_R2_train_vs_test.jpg)
]

- There is some overfitting going on: high variance in test results (?)

---

## Trying to figure out **independent** contributions

![](../figs/shellstrength_R2_progression.jpg)

- Shell Vol Ratio is the trait with the highest correlation, so no surprise there

---

## Trying to figure out **independent** contributions

![](../figs/easeofremoval_R2_progression.jpg)

---

background-image: url("https://upload.wikimedia.org/wikipedia/commons/4/4a/University_of_Missouri_logo.svg")
background-size: 60px
background-position: 99% 1%

class: inverse

# Thank you!

<div class="row" style="margin-top: -25px;">
  <div class="column" style="max-width:20%; font-size: 16px;">
    <img style="padding: 0 0 0 0;" src="https://i1.rgstatic.net/ii/profile.image/607374528233472-1521820780707_Q128/Elizabeth-Munch.jpg">
    <p style="text-align: center;">Liz Munch<br>(MSU)</p>
    <img style="padding: 0 0 0 0;" src="https://i1.rgstatic.net/ii/profile.image/926632407748609-1597937790454_Q128/Michelle-Quigley.jpg">
    <p style="text-align: center;">Michelle Quigley<br>(PSU)</p>
  </div>
  <div class="column" style="max-width:18%; font-size: 16px;">
    <img style="padding: 0 0 0 0;" src="https://directory.natsci.msu.edu/media/Directory/Profiles/dhchitwood20230719102707.jpg">
    <p style="text-align: center;">Dan Chitwood<br>(MSU)</p>
    <img style="padding: 0 0 0 0;" src="https://caes.ucdavis.edu/sites/g/files/dgvnsk1721/files/styles/sf_profile/public/images/person/pjbrown_1.jpg?h=345be249&itok=77W2Yqpk">
    <p style="text-align: center;">Pat Brown<br>(UC Davis)</p>
  </div>
  <div class="column" style="width:12%; font-size: 24px;">
  </div>
  <div class="column" style="max-width:50%; font-size: 24px; line-height:1.25">
    <p style="text-align: center;"><strong>Email</strong></p>
    <p style="text-align: center; color: Blue; font-family: monospace;">eah4d@missouri.edu</p>
    <p style="text-align: center;"><strong>Website and slides</strong></p>
    <p style="text-align: center; color: Blue; font-family: monospace;">ejamezquita.github.io</p>
    <p style="text-align: center;"><strong>Preprint DOI</strong></p>
    <p style="text-align: center; color: Blue; font-family: monospace;">10.1101/2023.09.26.559651</p>
    <img style="padding: 0 0 0 0;" src="../../cmse/figs/institutional_logos.jpg">
  </div>
</div>
